<!DOCTYPE html>
<html lang="nl" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analogy Game Facilitator - Het Ren-Je-Rot-Analogie-Verkenner-spel</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Supporting Libraries -->
    <script src="https://unpkg.com/localforage@1.10.0/dist/localforage.min.js"></script>
    <script src="https://unpkg.com/hotkeys-js@3.10.3/dist/hotkeys.esm.js" type="module"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .timer-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-button {
            animation: pulse 2s infinite;
        }
        
        .timer-completed {
            background-color: #fef2f2 !important;
            border: 2px solid #dc2626 !important;
            animation: pulse 1s infinite;
        }
        
        .timer-completed .text-3xl {
            color: #dc2626 !important;
        }
        
        @media (min-width: 1024px) {
            .presentation-mode .control-panel {
                display: none;
            }
        }
    </style>
</head>

<body class="h-full font-sans antialiased" x-data="gameApp">
    <!-- Loading Screen -->
    <div x-show="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Loading Analogy Game Facilitator...</p>
        </div>
    </div>

    <!-- Main Application -->
    <div x-show="!loading" class="h-full flex flex-col">
        
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <!-- Logo & Title -->
                    <div class="flex items-center space-x-4">
                        <div class="flex-shrink-0">
                            <h1 class="text-xl font-bold text-gray-900">Analogy Game Facilitator</h1>
                            <p class="text-sm text-gray-500">Het Ren-Je-Rot-Analogie-Verkenner-spel</p>
                        </div>
                    </div>
                    
                    <!-- Session Info & Controls -->
                    <div class="flex items-center space-x-4">
                        <div class="text-right text-sm">
                            <p class="font-medium text-gray-900" x-text="session.teamName || 'New Session'"></p>
                            <p class="text-gray-500" x-text="session.facilitator || 'No Facilitator'"></p>
                        </div>
                        
                        <!-- Phase Navigation -->
                        <nav class="flex space-x-2">
                            <template x-for="(phase, index) in phases" :key="index">
                                <button 
                                    @click="setCurrentPhase(index + 1)"
                                    :class="currentPhase === (index + 1) ? 'bg-primary-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                                    class="px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200"
                                    x-text="'Phase ' + (index + 1)"
                                ></button>
                            </template>
                        </nav>
                        
                        <!-- Utility Buttons -->
                        <div class="flex items-center space-x-2">
                            <button @click="presentationMode = !presentationMode" 
                                    :class="presentationMode ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-700'"
                                    class="px-3 py-2 rounded-md text-sm font-medium hover:bg-opacity-90 transition-colors">
                                <span x-show="!presentationMode">Present</span>
                                <span x-show="presentationMode">Control</span>
                            </button>
                            
                            <button @click="showSessionModal = true" 
                                    class="px-3 py-2 bg-gray-100 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors">
                                Settings
                            </button>
                            
                            <button @click="exportSession()" 
                                    class="px-3 py-2 bg-primary-600 text-white rounded-md text-sm font-medium hover:bg-primary-700 transition-colors">
                                Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex" :class="presentationMode ? 'presentation-mode' : ''">
            
            <!-- Control Panel (Hidden in presentation mode) -->
            <aside class="control-panel w-80 bg-white border-r border-gray-200 flex flex-col">
                <!-- Phase Selector -->
                <div class="p-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold mb-3" x-text="phases[currentPhase - 1]?.title"></h2>
                    <p class="text-sm text-gray-600" x-text="phases[currentPhase - 1]?.description"></p>
                </div>
                
                <!-- Phase-specific Controls -->
                <div class="flex-1 overflow-y-auto p-4">
                    <!-- Phase 1: Preference Round Controls -->
                    <div x-show="currentPhase === 1" class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Current Round</h3>
                            <p class="text-sm text-gray-600 mb-2">Round <span x-text="phase1.currentRound + 1"></span> of <span x-text="phase1.companyPairs.length"></span></p>
                            
                            <div class="flex space-x-2">
                                <button @click="previousRound()" 
                                        :disabled="phase1.currentRound === 0"
                                        class="px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                    Previous
                                </button>
                                <button @click="nextRound()" 
                                        :disabled="phase1.currentRound >= phase1.companyPairs.length - 1"
                                        class="px-3 py-1 bg-primary-600 text-white rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                    Next
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Timer</h3>
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="text-2xl font-bold" x-text="timer.remaining"></span>
                                <span class="text-gray-500">seconds</span>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button @click="startTimer()" 
                                        :disabled="timer.running"
                                        class="px-3 py-1 bg-green-600 text-white rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                    Start
                                </button>
                                <button @click="pauseTimer()" 
                                        :disabled="!timer.running"
                                        class="px-3 py-1 bg-yellow-600 text-white rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                    Pause
                                </button>
                                <button @click="resetTimer()" 
                                        class="px-3 py-1 bg-gray-600 text-white rounded text-sm">
                                    Reset
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Vote Counting</h3>
                            <div x-show="phase1.companyPairs[phase1.currentRound]" class="space-y-2">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm" x-text="phase1.companyPairs[phase1.currentRound]?.companyA.name"></span>
                                    <div class="flex items-center space-x-2">
                                        <button @click="adjustVote('A', -1)" class="w-6 h-6 bg-red-500 text-white rounded-full text-xs">-</button>
                                        <span class="w-8 text-center font-medium" x-text="phase1.results[phase1.currentRound]?.votesA || 0"></span>
                                        <button @click="adjustVote('A', 1)" class="w-6 h-6 bg-green-500 text-white rounded-full text-xs">+</button>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-sm" x-text="phase1.companyPairs[phase1.currentRound]?.companyB.name"></span>
                                    <div class="flex items-center space-x-2">
                                        <button @click="adjustVote('B', -1)" class="w-6 h-6 bg-red-500 text-white rounded-full text-xs">-</button>
                                        <span class="w-8 text-center font-medium" x-text="phase1.results[phase1.currentRound]?.votesB || 0"></span>
                                        <button @click="adjustVote('B', 1)" class="w-6 h-6 bg-green-500 text-white rounded-full text-xs">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Scorecard -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Scorecard</h3>
                            <div class="space-y-1 text-xs">
                                <template x-for="(result, index) in phase1.results" :key="index">
                                    <div class="flex justify-between items-center py-1 border-b border-gray-200 last:border-b-0">
                                        <span x-text="'Round ' + (index + 1)"></span>
                                        <span class="font-medium text-green-600" x-text="result.winner"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Phase 2: Preference Round Controls -->
                    <div x-show="currentPhase === 2" class="space-y-4">
                        <!-- Physical Positioning Timer Control Panel -->
                        <div class="bg-gradient-to-br from-blue-50 to-green-50 rounded-lg p-4 border border-blue-200">
                            <!-- Header with Status -->
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="font-semibold text-lg text-gray-800">Physical Positioning Round</h3>
                                    <div class="flex items-center space-x-3 mt-1">
                                        <!-- Current Status Indicator -->
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 rounded-full" 
                                                 :class="{
                                                   'bg-gray-400': phase2?.timerState === 'ready',
                                                   'bg-green-500 animate-pulse': phase2?.timerState === 'announcement',
                                                   'bg-blue-500': phase2?.timerState === 'countdown',
                                                   'bg-red-500': phase2?.timerState === 'completed',
                                                   'bg-purple-500': phase2?.timerState === 'discussion'
                                                 }"></div>
                                            <span class="text-sm text-gray-600 capitalize" x-text="phase2?.timerState || 'ready'"></span>
                                        </div>
                                        
                                        <!-- Round Progress -->
                                        <div class="text-sm text-gray-500">
                                            Round <span x-text="(phase2?.currentPairIndex || 0) + 1"></span> of <span x-text="phase2?.companyPairs?.pairs?.length || 5"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Audio Controls -->
                                <div class="flex items-center space-x-2">
                                    <!-- Audio Enable Button (fallback for manual enable if auto-enable fails) -->
                                    <button @click="phase2?.initAudio().then(() => $nextTick())" 
                                            x-show="!phase2?.audioState?.isEnabled && phase2?.timerState !== 'ready'"
                                            class="px-3 py-1 bg-blue-500 text-white rounded-md text-xs font-medium hover:bg-blue-600 shadow-sm"
                                            title="Enable audio for countdown beeps and completion bell">
                                        🔊 Enable Audio
                                    </button>
                                    
                                    <!-- Mute/Unmute Toggle -->
                                    <button @click="phase2?.toggleAudioMute(); $nextTick()" 
                                            x-show="phase2?.audioState?.isEnabled"
                                            :class="phase2?.audioState?.isMuted ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'"
                                            class="px-2 py-1 text-white rounded-md text-sm shadow-sm transition-colors"
                                            :title="phase2?.audioState?.isMuted ? 'Unmute audio' : 'Mute audio'">
                                        <span x-text="phase2?.audioState?.isMuted ? '🔇' : '🔊'"></span>
                                    </button>
                                </div>
                            </div>
                            <!-- Timer Display Area -->
                            <div class="bg-white rounded-lg p-6 border shadow-sm mb-4">
                                <div class="text-center">
                                    <!-- Ready State -->
                                    <div x-show="phase2?.timerState === 'ready'" class="space-y-2">
                                        <div class="text-3xl font-bold text-gray-600">Ready to Start</div>
                                        <div class="text-sm text-gray-500">Click "Start Round" when participants are ready</div>
                                    </div>
                                    
                                    <!-- Announcement State -->
                                    <div x-show="phase2?.timerState === 'announcement'" class="space-y-2">
                                        <div class="text-5xl font-bold text-green-600 animate-pulse">Ready? GO!</div>
                                        <div class="text-sm text-green-700">Participants get ready to move...</div>
                                    </div>
                                    
                                    <!-- Countdown State -->
                                    <div x-show="phase2?.timerState === 'countdown'" class="space-y-2"
                                         :class="(phase2?.timerLeft || 10) <= 3 ? 'text-red-600' : 'text-blue-600'">
                                        <div class="text-7xl font-bold tabular-nums" x-text="phase2?.timerLeft || 10"></div>
                                        <div class="text-lg font-medium">seconds to choose position</div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                                            <div class="bg-current h-2 rounded-full transition-all duration-1000"
                                                 :style="`width: ${((10 - (phase2?.timerLeft || 10)) / 10) * 100}%`"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Completed State -->
                                    <div x-show="phase2?.timerState === 'completed'" class="space-y-2">
                                        <div class="text-4xl font-bold text-red-600 animate-bounce">TIME'S UP!</div>
                                        <div class="text-sm text-red-700">Transitioning to discussion...</div>
                                    </div>
                                    
                                    <!-- Discussion State -->
                                    <div x-show="phase2?.timerState === 'discussion'" class="space-y-2">
                                        <div class="text-2xl font-semibold text-purple-600">💬 Discussion & Reflection</div>
                                        <div class="text-sm text-purple-700">Facilitate discussion about the strategic choice</div>
                                        <div class="text-xs text-gray-500 mt-2">Click "Next Round" to continue to the next company pair</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Timer Control Buttons -->
                            <div class="flex justify-center space-x-3">
                                <!-- Start/Ready Button -->
                                <button @click="phase2?.startTimer()" 
                                        x-show="phase2?.timerState === 'ready'"
                                        class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold text-base hover:bg-green-700 shadow-lg transition-all transform hover:scale-105">
                                    🚀 Start Round
                                </button>
                                
                                <!-- Next Round Button (Discussion Phase) -->
                                <button @click="phase2?.nextRound()" 
                                        x-show="phase2?.timerState === 'discussion'"
                                        class="px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold text-base hover:bg-purple-700 shadow-lg transition-all transform hover:scale-105">
                                    ➡️ Next Round
                                </button>
                                
                                <!-- Pause Button (Countdown Phase) -->
                                <button @click="phase2?.pauseTimer()" 
                                        x-show="phase2?.timerState === 'countdown' && !phase2?.timer?.isPaused"
                                        class="px-4 py-2 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700 shadow-md transition-colors">
                                    ⏸️ Pause
                                </button>
                                
                                <!-- Resume Button (Paused) -->
                                <button @click="phase2?.startTimer()" 
                                        x-show="phase2?.timer?.isPaused"
                                        class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 shadow-md transition-colors">
                                    ▶️ Resume
                                </button>
                                
                                <!-- Reset Button (Emergency/Admin) -->
                                <button @click="phase2?.resetTimer()" 
                                        class="px-3 py-1 bg-gray-400 text-gray-700 rounded font-medium text-sm hover:bg-gray-500 hover:text-white transition-colors"
                                        title="Reset timer (emergency use)">
                                    🔄 Reset
                                </button>
                            </div>
                        </div>
                        
                        <!-- Company Pair Navigation & Progress -->
                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-200">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-semibold text-gray-800">Strategic Company Pairs</h3>
                                <div class="text-sm font-medium text-indigo-600">
                                    <span x-text="phase2?.pairCounter || '1 / 5'"></span>
                                </div>
                            </div>
                            
                            <!-- Current Pair Preview -->
                            <div class="bg-white rounded-lg p-3 mb-3 border shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-800 mb-1" x-text="phase2?.currentPair?.category || 'Strategic Dilemma'"></div>
                                        <div class="flex items-center space-x-2 text-sm text-gray-600">
                                            <span class="font-medium text-blue-600" x-text="phase2?.currentPair?.companyA || 'Company A'"></span>
                                            <span class="text-gray-400">vs</span>
                                            <span class="font-medium text-green-600" x-text="phase2?.currentPair?.companyB || 'Company B'"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Navigation Controls -->
                            <div class="flex justify-between items-center">
                                <button @click="phase2?.previousPair()" 
                                        :disabled="!phase2?.companyPairs?.canGoPrev"
                                        class="px-3 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                    ← Previous
                                </button>
                                
                                <!-- Progress Dots -->
                                <div class="flex space-x-2">
                                    <template x-for="(pair, index) in phase2?.companyPairs?.pairs || [1,2,3,4,5]" :key="index">
                                        <button @click="phase2?.companyPairs?.goToPair ? phase2.companyPairs.goToPair(index) : null"
                                                class="w-3 h-3 rounded-full transition-colors"
                                                :class="index === (phase2?.currentPairIndex || 0) ? 'bg-indigo-600' : 'bg-gray-300 hover:bg-gray-400'"
                                                :title="`Go to pair ${index + 1}`"></button>
                                    </template>
                                </div>
                                
                                <button @click="phase2?.nextPair()" 
                                        :disabled="!phase2?.companyPairs?.canGoNext"
                                        class="px-3 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                    Next →
                                </button>
                            </div>
                        </div>
                        
                        <!-- Voting & Statistics Dashboard -->
                        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-lg p-4 border border-orange-200">
                            <h3 class="font-semibold text-gray-800 mb-3">Vote Tracking & Results</h3>
                            
                            <!-- Vote Buttons -->
                            <div class="space-y-3 mb-4">
                                <div class="bg-white rounded-lg p-3 border shadow-sm">
                                    <div class="flex justify-between items-center mb-2">
                                        <span x-text="phase2?.currentPair?.companyA || 'Company A'" class="font-semibold text-blue-700"></span>
                                        <span class="text-2xl font-bold text-blue-600" x-text="phase2?.votes?.companyA || 0"></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button @click="phase2?.voteA()" 
                                                class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                                            + Vote for A
                                        </button>
                                        <button @click="phase2?.decreaseVoteA()" 
                                                class="px-2 py-2 bg-blue-400 text-white rounded-lg font-medium hover:bg-blue-500 transition-colors text-xs"
                                                title="Decrease vote (Shift+A)">
                                            −
                                        </button>
                                        <div class="text-xs text-gray-500 w-12 text-right" x-text="`${phase2?.votingSystem?.percentageA || 0}%`"></div>
                                    </div>
                                </div>
                                
                                <div class="bg-white rounded-lg p-3 border shadow-sm">
                                    <div class="flex justify-between items-center mb-2">
                                        <span x-text="phase2?.currentPair?.companyB || 'Company B'" class="font-semibold text-green-700"></span>
                                        <span class="text-2xl font-bold text-green-600" x-text="phase2?.votes?.companyB || 0"></span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button @click="phase2?.voteB()" 
                                                class="flex-1 px-3 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors">
                                            + Vote for B
                                        </button>
                                        <button @click="phase2?.decreaseVoteB()" 
                                                class="px-2 py-2 bg-green-400 text-white rounded-lg font-medium hover:bg-green-500 transition-colors text-xs"
                                                title="Decrease vote (Shift+B)">
                                            −
                                        </button>
                                        <div class="text-xs text-gray-500 w-12 text-right" x-text="`${phase2?.votingSystem?.percentageB || 0}%`"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Visual Vote Distribution -->
                            <div x-show="(phase2?.votes?.companyA || 0) + (phase2?.votes?.companyB || 0) > 0" class="mb-4">
                                <div class="text-xs text-gray-600 mb-2 flex justify-between">
                                    <span>Vote Distribution</span>
                                    <span class="font-medium">Total: <span x-text="phase2?.votingSystem?.totalVotes || 0"></span></span>
                                </div>
                                <div class="flex rounded-full overflow-hidden h-4 bg-gray-200">
                                    <div class="bg-blue-500 transition-all duration-500 flex items-center justify-center text-white text-xs font-medium"
                                         :style="`width: ${phase2?.votingSystem?.percentageA || 0}%`"
                                         x-text="(phase2?.votingSystem?.percentageA || 0) > 15 ? `${phase2?.votingSystem?.percentageA || 0}%` : ''"></div>
                                    <div class="bg-green-500 transition-all duration-500 flex items-center justify-center text-white text-xs font-medium"
                                         :style="`width: ${phase2?.votingSystem?.percentageB || 0}%`"
                                         x-text="(phase2?.votingSystem?.percentageB || 0) > 15 ? `${phase2?.votingSystem?.percentageB || 0}%` : ''"></div>
                                </div>
                            </div>
                            
                            <!-- Reset Button -->
                            <button @click="phase2?.resetVotes()" 
                                    class="w-full px-3 py-2 bg-orange-500 text-white rounded-lg font-medium hover:bg-orange-600 transition-colors text-sm">
                                🔄 Reset Current Pair Votes
                            </button>
                        </div>
                        
                        <!-- Facilitator Instructions -->
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-4 border border-yellow-200">
                            <h3 class="font-semibold text-gray-800 mb-2">💡 Facilitator Guide</h3>
                            <div class="text-sm space-y-2">
                                <div x-show="phase2?.timerState === 'ready'" class="text-gray-700">
                                    <strong>Ready Phase:</strong> Explain the strategic dilemma to participants, then click "Start Round"
                                </div>
                                <div x-show="phase2?.timerState === 'announcement'" class="text-green-700">
                                    <strong>Announcement:</strong> Participants prepare to move to their chosen side
                                </div>
                                <div x-show="phase2?.timerState === 'countdown'" class="text-blue-700">
                                    <strong>Countdown:</strong> Participants choose their position (left/right) based on preference
                                </div>
                                <div x-show="phase2?.timerState === 'completed'" class="text-red-700">
                                    <strong>Time's Up:</strong> Count participants on each side and record votes
                                </div>
                                <div x-show="phase2?.timerState === 'discussion'" class="text-purple-700">
                                    <strong>Discussion:</strong> Facilitate reflection on the strategic choice and reasoning
                                </div>
                            </div>
                            
                            <!-- Keyboard Shortcuts -->
                            <div class="mt-3 pt-3 border-t border-yellow-200">
                                <div class="text-xs text-gray-600 mb-1">Keyboard Shortcuts:</div>
                                <div class="grid grid-cols-2 gap-1 text-xs">
                                    <div><kbd class="bg-gray-200 px-1 rounded">Space</kbd> Start/Pause</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">R</kbd> Reset Timer</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">←/→</kbd> Navigate Pairs</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">A/B</kbd> Vote A/B</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">Shift+A/B</kbd> Decrease Votes</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">N</kbd> Next Round</div>
                                    <div><kbd class="bg-gray-200 px-1 rounded">Ctrl+Del</kbd> Clear Storage</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Phase 3: Decomposition Controls -->
                    <div x-show="currentPhase === 3" class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Select Forerunner</h3>
                            <select x-model="phase3.forerunner" class="w-full p-2 border border-gray-300 rounded text-sm mb-2">
                                <option value="">Choose a company...</option>
                                <template x-for="winner in getWinners()" :key="winner">
                                    <option :value="winner" x-text="winner"></option>
                                </template>
                            </select>
                            <p class="text-xs text-gray-500" x-show="!phase3.forerunner">Select the most representative company for deep analysis</p>
                            <p class="text-xs text-green-600" x-show="phase3.forerunner" x-text="'Analyzing: ' + phase3.forerunner"></p>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4" x-show="phase3.forerunner">
                            <h3 class="font-medium mb-2">Add Analysis Items</h3>
                            <div class="space-y-2">
                                <button @click="addPositiveAnalogy()" 
                                        class="w-full px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                    + Positive Analogy
                                </button>
                                <button @click="addNegativeAnalogy()" 
                                        class="w-full px-3 py-2 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                    + Negative Analogy
                                </button>
                                <button @click="addCausalRelation()" 
                                        class="w-full px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                    + Causal Relation
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Analysis Progress</h3>
                            <div class="space-y-2 text-xs">
                                <div class="flex justify-between">
                                    <span>Positive Analogies</span>
                                    <span class="text-green-600" x-text="phase3.positiveAnalogies.length + ' items'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Negative Analogies</span>
                                    <span class="text-red-600" x-text="phase3.negativeAnalogies.length + ' items'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Causal Relations</span>
                                    <span class="text-blue-600" x-text="phase3.causalRelations.length + ' items'"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4" x-show="phase3.forerunner">
                            <h3 class="font-medium mb-2">Guided Questions</h3>
                            <div class="space-y-2 text-xs text-gray-700">
                                <div class="p-2 bg-green-50 rounded border border-green-200">
                                    <p class="font-medium text-green-800">Positive Analogies:</p>
                                    <p>What business model elements are similar to ours?</p>
                                </div>
                                <div class="p-2 bg-red-50 rounded border border-red-200">
                                    <p class="font-medium text-red-800">Negative Analogies:</p>
                                    <p>What fundamental differences exist?</p>
                                </div>
                                <div class="p-2 bg-blue-50 rounded border border-blue-200">
                                    <p class="font-medium text-blue-800">Causal Relations:</p>
                                    <p>Which factors lead directly to their success?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Phase 4: Translation Controls -->
                    <div x-show="currentPhase === 4" class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Strategic Hypotheses</h3>
                            <button @click="addHypothesis()" 
                                    class="w-full px-3 py-2 bg-primary-600 text-white rounded text-sm hover:bg-primary-700 mb-3">
                                + Add New Hypothesis
                            </button>
                            
                            <div class="space-y-2 text-xs">
                                <template x-for="(hypothesis, index) in phase4.hypotheses" :key="index">
                                    <div class="flex justify-between items-center py-2 px-3 bg-white rounded border">
                                        <div class="flex-1">
                                            <span class="font-medium" x-text="'Hypothesis ' + (index + 1)"></span>
                                            <p class="text-gray-600 mt-1 text-xs" 
                                               x-text="hypothesis.statement ? (hypothesis.statement.substring(0, 50) + '...') : 'Not defined'"></p>
                                        </div>
                                        <button @click="removeHypothesis(index)" 
                                                class="text-red-500 hover:text-red-700 ml-2">✕</button>
                                    </div>
                                </template>
                            </div>
                            
                            <div x-show="phase4.hypotheses.length === 0" class="text-center py-4 text-gray-500 text-xs">
                                No hypotheses created yet
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Hypothesis Templates</h3>
                            <select @change="applyHypothesisTemplate($event.target.value)" 
                                    class="w-full p-2 border border-gray-300 rounded text-sm mb-2">
                                <option value="">Choose a template...</option>
                                <option value="platform">Platform Strategy</option>
                                <option value="premium">Premium Positioning</option>
                                <option value="ecosystem">Ecosystem Building</option>
                                <option value="innovation">Innovation Focus</option>
                                <option value="customer">Customer-Centric</option>
                            </select>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Action Items</h3>
                            <button @click="addActionItem()" 
                                    class="w-full px-3 py-2 bg-green-600 text-white rounded text-sm hover:bg-green-700 mb-3">
                                + Add Action Item
                            </button>
                            
                            <div class="space-y-2 text-xs">
                                <template x-for="(action, index) in phase4.actionItems" :key="index">
                                    <div class="flex justify-between items-center py-2 px-3 bg-white rounded border">
                                        <div class="flex-1">
                                            <span class="font-medium" x-text="action.task || 'New Action'"></span>
                                            <p class="text-gray-600 text-xs" x-text="action.owner ? 'Owner: ' + action.owner : 'No owner assigned'"></p>
                                        </div>
                                        <button @click="removeActionItem(index)" 
                                                class="text-red-500 hover:text-red-700 ml-2">✕</button>
                                    </div>
                                </template>
                            </div>
                            
                            <div x-show="phase4.actionItems.length === 0" class="text-center py-4 text-gray-500 text-xs">
                                No action items created yet
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium mb-2">Session Summary</h3>
                            <div class="space-y-2 text-xs">
                                <div class="flex justify-between">
                                    <span>Archetype Defined:</span>
                                    <span :class="phase2.archetype ? 'text-green-600' : 'text-gray-500'" 
                                          x-text="phase2.archetype ? '✓ Yes' : 'Not yet'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Forerunner Analyzed:</span>
                                    <span :class="phase3.forerunner ? 'text-green-600' : 'text-gray-500'" 
                                          x-text="phase3.forerunner || 'Not selected'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Hypotheses Created:</span>
                                    <span class="text-blue-600" x-text="phase4.hypotheses.length"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Actions Planned:</span>
                                    <span class="text-green-600" x-text="phase4.actionItems.length"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Save Status -->
                <div class="p-4 border-t border-gray-200 bg-gray-50">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-600">Auto-save</span>
                        <span :class="saveStatus === 'saved' ? 'text-green-600' : 'text-yellow-600'" 
                              x-text="saveStatus"></span>
                    </div>
                </div>
            </aside>
            
            <!-- Presentation Area -->
            <section class="flex-1 bg-white flex flex-col">
                <!-- Phase 1: Company Pair Presentation -->
                <div x-show="currentPhase === 1" class="flex-1 flex">
                    <!-- Company Pair Display -->
                    <div x-show="phase1.companyPairs[phase1.currentRound]" class="w-full flex">
                        <!-- Company A -->
                        <div class="w-1/2 bg-blue-50 flex flex-col items-center justify-center p-8 border-r-2 border-gray-300">
                            <div class="text-center">
                                <h2 class="text-4xl font-bold mb-4 text-blue-900" 
                                    x-text="phase1.companyPairs[phase1.currentRound]?.companyA.name"></h2>
                                <p class="text-lg text-blue-700 mb-6" 
                                   x-text="phase1.companyPairs[phase1.currentRound]?.companyA.description"></p>
                                <div class="text-6xl font-bold text-blue-600" 
                                     x-text="phase1.results[phase1.currentRound]?.votesA || 0"></div>
                                <p class="text-blue-600 mt-2">votes</p>
                            </div>
                        </div>
                        
                        <!-- VS Divider with Timer -->
                        <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-full p-4 border-4 border-gray-300 z-10">
                            <div class="relative w-16 h-16">
                                <!-- Timer Ring -->
                                <svg class="w-16 h-16 timer-ring" viewBox="0 0 64 64">
                                    <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
                                    <circle cx="32" cy="32" r="28" 
                                            :stroke="timer.remaining <= 5 ? '#dc2626' : timer.remaining <= 10 ? '#f59e0b' : '#059669'"
                                            stroke-width="4" fill="none" stroke-linecap="round"
                                            :stroke-dasharray="175.84"
                                            :stroke-dashoffset="175.84 - (175.84 * timer.remaining / timer.duration)"></circle>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-lg font-bold" x-text="timer.remaining"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Company B -->
                        <div class="w-1/2 bg-green-50 flex flex-col items-center justify-center p-8">
                            <div class="text-center">
                                <h2 class="text-4xl font-bold mb-4 text-green-900" 
                                    x-text="phase1.companyPairs[phase1.currentRound]?.companyB.name"></h2>
                                <p class="text-lg text-green-700 mb-6" 
                                   x-text="phase1.companyPairs[phase1.currentRound]?.companyB.description"></p>
                                <div class="text-6xl font-bold text-green-600" 
                                     x-text="phase1.results[phase1.currentRound]?.votesB || 0"></div>
                                <p class="text-green-600 mt-2">votes</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Question Overlay -->
                    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 bg-white bg-opacity-95 rounded-lg p-6 shadow-lg">
                        <h3 class="text-2xl font-semibold text-center text-gray-900">
                            Wie willen we liever zijn?
                        </h3>
                    </div>
                </div>
                
                <!-- Phase 2: Preference Round Display -->
                <div x-show="currentPhase === 2" class="flex-1 flex" 
                     :class="{
                         'bg-gradient-to-br from-blue-100 to-green-100': phase2?.timerState === 'ready',
                         'bg-gradient-to-br from-green-200 to-yellow-200 animate-pulse': phase2?.timerState === 'announcement',
                         'bg-gradient-to-br from-gray-100 to-gray-50': phase2?.timerState === 'countdown',
                         'bg-gradient-to-br from-red-100 to-orange-100': phase2?.timerState === 'completed',
                         'bg-gradient-to-br from-purple-100 to-pink-100': phase2?.timerState === 'discussion'
                     }">
                    
                    <!-- Position Guide Arrows (Presentation Mode Only) -->
                    <div class="absolute top-8 left-8 z-20" 
                         x-show="presentationMode && (phase2?.timerState === 'countdown' || phase2?.timerState === 'announcement')">
                        <div class="flex items-center bg-blue-900 text-white px-6 py-3 rounded-full shadow-lg">
                            <span class="text-2xl mr-3">←</span>
                            <span class="font-bold text-lg">Go LEFT for</span>
                        </div>
                    </div>
                    
                    <div class="absolute top-8 right-8 z-20" 
                         x-show="presentationMode && (phase2?.timerState === 'countdown' || phase2?.timerState === 'announcement')">
                        <div class="flex items-center bg-green-900 text-white px-6 py-3 rounded-full shadow-lg">
                            <span class="font-bold text-lg">Go RIGHT for</span>
                            <span class="text-2xl ml-3">→</span>
                        </div>
                    </div>
                    
                    <!-- Company Pair Display -->
                    <div class="w-full flex relative">
                        <!-- Company A -->
                        <div class="w-1/2 flex flex-col items-center justify-center p-12 border-r-4" 
                             :class="{
                                 'bg-blue-50 border-blue-300': phase2?.timerState !== 'countdown',
                                 'bg-blue-200 border-blue-500 shadow-inner': phase2?.timerState === 'countdown'
                             }">
                            <div class="text-center max-w-lg">
                                <h2 class="text-6xl font-black mb-6 leading-tight" 
                                    :class="{
                                        'text-blue-900': phase2?.timerState !== 'countdown',
                                        'text-blue-800': phase2?.timerState === 'countdown'
                                    }"
                                    x-text="phase2?.currentPair?.companyA || 'Company A'"></h2>
                                    
                                <!-- Vote Count (Discussion Phase) -->
                                <div x-show="phase2?.timerState === 'discussion'" class="mb-6">
                                    <div class="text-8xl font-bold text-blue-600 mb-2" 
                                         x-text="phase2?.votes?.companyA || 0"></div>
                                    <p class="text-xl text-blue-600 font-semibold">participants</p>
                                </div>
                                
                                <!-- Strategic Description -->
                                <div class="mt-8">
                                    <p class="text-lg text-blue-800 mb-4 font-medium leading-relaxed" 
                                       x-text="phase2?.currentPair?.companyADescription"></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Simplified VS Divider with Timer -->
                        <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500"
                             :class="{
                                 'z-30': presentationMode,
                                 'z-10': !presentationMode
                             }">
                            <div class="bg-white rounded-full border-4 shadow-2xl flex items-center justify-center transition-all duration-500" 
                                 :class="{
                                     'w-32 h-32': presentationMode,
                                     'w-20 h-20': !presentationMode,
                                     'border-gray-400 bg-white': phase2?.timerState === 'ready',
                                     'border-green-600 bg-green-400 animate-pulse': phase2?.timerState === 'announcement',
                                     'border-blue-500 bg-white': phase2?.timerState === 'countdown',
                                     'border-red-600 bg-red-400': phase2?.timerState === 'completed',
                                     'border-purple-600 bg-purple-400': phase2?.timerState === 'discussion'
                                 }">
                                
                                <!-- Timer Ring (Countdown only) -->
                                <svg x-show="phase2?.timerState === 'countdown'" 
                                     :class="presentationMode ? 'w-32 h-32' : 'w-20 h-20'"
                                     class="absolute" 
                                     :viewBox="presentationMode ? '0 0 128 128' : '0 0 80 80'">
                                    <circle :cx="presentationMode ? '64' : '40'" 
                                            :cy="presentationMode ? '64' : '40'" 
                                            :r="presentationMode ? '58' : '36'" 
                                            stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
                                    <circle :cx="presentationMode ? '64' : '40'" 
                                            :cy="presentationMode ? '64' : '40'" 
                                            :r="presentationMode ? '58' : '36'"
                                            :stroke="(phase2?.timerLeft || 10) <= 3 ? '#dc2626' : (phase2?.timerLeft || 10) <= 5 ? '#f59e0b' : '#059669'"
                                            stroke-width="4" fill="none" stroke-linecap="round" 
                                            :stroke-dasharray="presentationMode ? '364.42' : '226.19'"
                                            :stroke-dashoffset="presentationMode ? (364.42 - (364.42 * (10 - (phase2?.timerLeft || 10)) / 10)) : (226.19 - (226.19 * (10 - (phase2?.timerLeft || 10)) / 10))"
                                            class="transition-all duration-1000"></circle>
                                </svg>
                                
                                <div class="text-center z-10">
                                    <!-- Ready State -->
                                    <div x-show="phase2?.timerState === 'ready'">
                                        <div :class="presentationMode ? 'text-sm' : 'text-xs'" 
                                             class="font-bold text-gray-700">READY</div>
                                    </div>
                                    
                                    <!-- Announcement State -->
                                    <div x-show="phase2?.timerState === 'announcement'" class="animate-bounce">
                                        <div :class="presentationMode ? 'text-2xl' : 'text-lg'" 
                                             class="font-black text-white">GO!</div>
                                    </div>
                                    
                                    <!-- Countdown State -->
                                    <div x-show="phase2?.timerState === 'countdown'">
                                        <div :class="{
                                                 'text-3xl': presentationMode,
                                                 'text-xl': !presentationMode,
                                                 'text-red-600 animate-pulse': (phase2?.timerLeft || 10) <= 3,
                                                 'text-orange-600': (phase2?.timerLeft || 10) <= 5 && (phase2?.timerLeft || 10) > 3,
                                                 'text-blue-600': (phase2?.timerLeft || 10) > 5
                                             }"
                                             class="font-black"
                                             x-text="phase2?.timerLeft || 10"></div>
                                    </div>
                                    
                                    <!-- Completed State -->
                                    <div x-show="phase2?.timerState === 'completed'" class="animate-bounce">
                                        <div :class="presentationMode ? 'text-lg' : 'text-sm'" 
                                             class="font-black text-white">STOP!</div>
                                    </div>
                                    
                                    <!-- Discussion State -->
                                    <div x-show="phase2?.timerState === 'discussion'">
                                        <div :class="presentationMode ? 'text-lg' : 'text-sm'" 
                                             class="text-white">💬</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Company B -->
                        <div class="w-1/2 flex flex-col items-center justify-center p-12" 
                             :class="{
                                 'bg-green-50': phase2?.timerState !== 'countdown',
                                 'bg-green-200 shadow-inner': phase2?.timerState === 'countdown'
                             }">
                            <div class="text-center max-w-lg">
                                <h2 class="text-6xl font-black mb-6 leading-tight" 
                                    :class="{
                                        'text-green-900': phase2?.timerState !== 'countdown',
                                        'text-green-800': phase2?.timerState === 'countdown'
                                    }"
                                    x-text="phase2?.currentPair?.companyB || 'Company B'"></h2>
                                    
                                <!-- Vote Count (Discussion Phase) -->
                                <div x-show="phase2?.timerState === 'discussion'" class="mb-6">
                                    <div class="text-8xl font-bold text-green-600 mb-2" 
                                         x-text="phase2?.votes?.companyB || 0"></div>
                                    <p class="text-xl text-green-600 font-semibold">participants</p>
                                </div>
                                
                                <!-- Strategic Description -->
                                <div class="mt-8">
                                    <p class="text-lg text-green-800 mb-4 font-medium leading-relaxed" 
                                       x-text="phase2?.currentPair?.companyBDescription"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Simplified Question Overlay (Presentation Mode Only) -->
                    <div x-show="presentationMode" 
                         class="absolute bottom-8 left-1/2 transform -translate-x-1/2 bg-white bg-opacity-95 rounded-2xl shadow-2xl p-6 max-w-3xl transition-all duration-500"
                         :class="{
                             'bg-yellow-400 bg-opacity-95 animate-pulse': phase2?.timerState === 'announcement'
                         }">
                        
                        <!-- Round Info Header -->
                        <div class="text-center mb-4">
                            <h3 class="text-2xl font-bold mb-2" 
                                :class="{
                                    'text-gray-900': phase2?.timerState !== 'announcement',
                                    'text-yellow-900': phase2?.timerState === 'announcement'
                                }">
                                Physical Positioning Workshop
                            </h3>
                            <p class="text-lg font-medium" 
                               :class="{
                                   'text-gray-600': phase2?.timerState !== 'announcement',
                                   'text-yellow-800': phase2?.timerState === 'announcement'
                               }">
                                Round <span x-text="phase2?.pairCounter || '1 / 5'"></span> - <span x-text="phase2?.currentPair?.category || 'Strategic Dilemma'"></span>
                            </p>
                        </div>
                        
                        <!-- Strategic Dilemma Question -->
                        <div x-show="phase2?.currentPair?.dilemma_question" class="mb-4 text-center">
                            <h4 class="font-bold mb-2" 
                                :class="{
                                    'text-gray-800': phase2?.timerState !== 'announcement',
                                    'text-yellow-900': phase2?.timerState === 'announcement'
                                }">Strategic Dilemma:</h4>
                            <p class="text-base font-medium" 
                               :class="{
                                   'text-gray-700': phase2?.timerState !== 'announcement',
                                   'text-yellow-800': phase2?.timerState === 'announcement'
                               }"
                               x-text="phase2?.currentPair?.dilemma_question"></p>
                        </div>
                        
                        <!-- Instructions based on timer state -->
                        <div class="text-center">
                            <div x-show="phase2?.timerState === 'ready'" class="text-gray-600">
                                <p class="font-semibold">Get ready to make your choice physically by moving left or right!</p>
                            </div>
                            <div x-show="phase2?.timerState === 'announcement'" class="text-yellow-900">
                                <p class="font-black text-lg animate-bounce">🏃‍♂️ MOVE TO YOUR POSITION NOW! 🏃‍♀️</p>
                            </div>
                            <div x-show="phase2?.timerState === 'countdown'" class="text-blue-700">
                                <p class="font-bold">Choose your side and stay there until time runs out!</p>
                            </div>
                            <div x-show="phase2?.timerState === 'completed'" class="text-red-700">
                                <p class="font-bold">⏰ Time's up! Stay in position for counting.</p>
                            </div>
                            <div x-show="phase2?.timerState === 'discussion'" class="text-purple-700">
                                <p class="font-bold">💬 Discuss your choice with others nearby!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Phase 3: Decomposition Display -->
                <div x-show="currentPhase === 3" class="flex-1 p-8 overflow-y-auto">
                    <div class="max-w-7xl mx-auto">
                        <h2 class="text-3xl font-bold text-center mb-8">
                            Decomposition Analysis: <span x-text="phase3.forerunner || 'Select Forerunner'" class="text-primary-600"></span>
                        </h2>
                        
                        <div x-show="!phase3.forerunner" class="text-center py-12">
                            <p class="text-gray-500 text-lg">Select a forerunner company from the control panel to begin analysis</p>
                        </div>
                        
                        <div x-show="phase3.forerunner" class="space-y-8">
                            <!-- Positive Analogies Section -->
                            <div>
                                <h3 class="text-2xl font-semibold mb-4 text-green-700">
                                    Positive Analogies <span class="text-sm text-gray-500">({phase3.positiveAnalogies.length} similarities identified)</span>
                                </h3>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <template x-for="(analogy, index) in phase3.positiveAnalogies" :key="index">
                                        <div class="bg-green-50 rounded-lg p-4 border border-green-200 relative group">
                                            <button @click="removePositiveAnalogy(index)" 
                                                    class="absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                                ✕
                                            </button>
                                            <div class="pr-8">
                                                <input x-model="analogy.category" 
                                                       placeholder="Category (e.g., Business Model, Customer Approach)"
                                                       class="w-full font-medium text-green-800 bg-transparent border-none p-0 mb-2 placeholder-green-600">
                                                <textarea x-model="analogy.description" 
                                                          placeholder="Describe the similarity in detail..."
                                                          class="w-full text-green-700 text-sm bg-transparent border-none p-0 resize-none placeholder-green-500"
                                                          rows="3"></textarea>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div x-show="phase3.positiveAnalogies.length === 0" class="text-center py-8 text-green-600 border-2 border-dashed border-green-300 rounded-lg">
                                    No positive analogies added yet. Use the control panel to add similarities.
                                </div>
                            </div>
                            
                            <!-- Negative Analogies Section -->
                            <div>
                                <h3 class="text-2xl font-semibold mb-4 text-red-700">
                                    Negative Analogies <span class="text-sm text-gray-500">({phase3.negativeAnalogies.length} differences identified)</span>
                                </h3>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <template x-for="(analogy, index) in phase3.negativeAnalogies" :key="index">
                                        <div class="bg-red-50 rounded-lg p-4 border border-red-200 relative group">
                                            <button @click="removeNegativeAnalogy(index)" 
                                                    class="absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                                ✕
                                            </button>
                                            <div class="pr-8">
                                                <input x-model="analogy.category" 
                                                       placeholder="Category (e.g., Market Context, Technology)"
                                                       class="w-full font-medium text-red-800 bg-transparent border-none p-0 mb-2 placeholder-red-600">
                                                <textarea x-model="analogy.description" 
                                                          placeholder="Describe the key difference..."
                                                          class="w-full text-red-700 text-sm bg-transparent border-none p-0 resize-none placeholder-red-500"
                                                          rows="3"></textarea>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div x-show="phase3.negativeAnalogies.length === 0" class="text-center py-8 text-red-600 border-2 border-dashed border-red-300 rounded-lg">
                                    No negative analogies added yet. Use the control panel to add differences.
                                </div>
                            </div>
                            
                            <!-- Causal Relations Section -->
                            <div>
                                <h3 class="text-2xl font-semibold mb-4 text-blue-700">
                                    Causal Relations <span class="text-sm text-gray-500">({phase3.causalRelations.length} connections mapped)</span>
                                </h3>
                                <div class="space-y-4">
                                    <template x-for="(relation, index) in phase3.causalRelations" :key="index">
                                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200 relative group">
                                            <button @click="removeCausalRelation(index)" 
                                                    class="absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                                ✕
                                            </button>
                                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center pr-8">
                                                <div class="md:col-span-2">
                                                    <label class="block text-xs text-blue-600 mb-1">Factor (Premise)</label>
                                                    <textarea x-model="relation.factor" 
                                                              placeholder="What specific factor or capability..."
                                                              class="w-full text-blue-800 bg-white border border-blue-300 rounded p-2 text-sm resize-none"
                                                              rows="2"></textarea>
                                                </div>
                                                <div class="text-center">
                                                    <div class="text-2xl text-blue-600">→</div>
                                                    <select x-model="relation.strength" class="text-xs bg-white border border-blue-300 rounded px-1 py-1 text-blue-700">
                                                        <option value="weak">Weak</option>
                                                        <option value="medium">Medium</option>
                                                        <option value="strong">Strong</option>
                                                    </select>
                                                </div>
                                                <div class="md:col-span-2">
                                                    <label class="block text-xs text-blue-600 mb-1">Outcome (Conclusion)</label>
                                                    <textarea x-model="relation.outcome" 
                                                              placeholder="Leads to what business result..."
                                                              class="w-full text-blue-800 bg-white border border-blue-300 rounded p-2 text-sm resize-none"
                                                              rows="2"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                                <div x-show="phase3.causalRelations.length === 0" class="text-center py-8 text-blue-600 border-2 border-dashed border-blue-300 rounded-lg">
                                    No causal relations mapped yet. Use the control panel to add cause-effect relationships.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Phase 4: Strategic Translation Display -->
                <div x-show="currentPhase === 4" class="flex-1 p-8 overflow-y-auto">
                    <div class="max-w-7xl mx-auto">
                        <h2 class="text-3xl font-bold text-center mb-8">Strategic Translation</h2>
                        
                        <!-- Strategic Hypotheses Section -->
                        <div class="mb-12">
                            <h3 class="text-2xl font-semibold mb-6">
                                Strategic Hypotheses <span class="text-sm text-gray-500">({phase4.hypotheses.length} hypotheses formulated)</span>
                            </h3>
                            
                            <div class="space-y-6">
                                <template x-for="(hypothesis, index) in phase4.hypotheses" :key="index">
                                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-primary-500 relative group">
                                        <button @click="removeHypothesis(index)" 
                                                class="absolute top-4 right-4 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                            ✕
                                        </button>
                                        
                                        <div class="pr-8">
                                            <h4 class="text-lg font-semibold mb-4 text-primary-800" x-text="'Hypothesis ' + (index + 1)"></h4>
                                            
                                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                                <!-- Premise (IF) Section -->
                                                <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                                    <label class="block text-sm font-medium text-blue-800 mb-2">
                                                        IF (Premise) - What we will implement:
                                                    </label>
                                                    <textarea x-model="hypothesis.premise" 
                                                              placeholder="IF we implement/adopt/build..."
                                                              class="w-full p-3 border border-blue-300 rounded text-sm resize-none bg-white"
                                                              rows="3"></textarea>
                                                </div>
                                                
                                                <!-- Conclusion (THEN) Section -->
                                                <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                                    <label class="block text-sm font-medium text-green-800 mb-2">
                                                        THEN (Conclusion) - Expected outcome:
                                                    </label>
                                                    <textarea x-model="hypothesis.conclusion" 
                                                              placeholder="THEN we expect to achieve..."
                                                              class="w-full p-3 border border-green-300 rounded text-sm resize-none bg-white"
                                                              rows="3"></textarea>
                                                </div>
                                            </div>
                                            
                                            <!-- Full Statement -->
                                            <div class="mt-4">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    Complete Hypothesis Statement:
                                                </label>
                                                <textarea x-model="hypothesis.statement" 
                                                          :placeholder="'IF ' + (hypothesis.premise || '[premise]') + ' THEN ' + (hypothesis.conclusion || '[conclusion]')"
                                                          class="w-full p-3 border border-gray-300 rounded text-sm resize-none bg-gray-50"
                                                          rows="2"></textarea>
                                            </div>
                                            
                                            <!-- Priority and Notes -->
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Priority:</label>
                                                    <select x-model="hypothesis.priority" class="w-full p-2 border border-gray-300 rounded text-sm bg-white">
                                                        <option value="high">High Priority</option>
                                                        <option value="medium">Medium Priority</option>
                                                        <option value="low">Low Priority</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Confidence:</label>
                                                    <select x-model="hypothesis.confidence" class="w-full p-2 border border-gray-300 rounded text-sm bg-white">
                                                        <option value="high">High Confidence</option>
                                                        <option value="medium">Medium Confidence</option>
                                                        <option value="low">Low Confidence</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            
                            <div x-show="phase4.hypotheses.length === 0" class="text-center py-12 text-primary-600 border-2 border-dashed border-primary-300 rounded-lg">
                                No strategic hypotheses created yet. Use the control panel to add hypotheses.
                            </div>
                        </div>
                        
                        <!-- Action Items Section -->
                        <div>
                            <h3 class="text-2xl font-semibold mb-6">
                                Next Actions <span class="text-sm text-gray-500">({phase4.actionItems.length} actions planned)</span>
                            </h3>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <template x-for="(action, index) in phase4.actionItems" :key="index">
                                    <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200 relative group">
                                        <button @click="removeActionItem(index)" 
                                                class="absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity">
                                            ✕
                                        </button>
                                        
                                        <div class="pr-8">
                                            <div class="mb-3">
                                                <label class="block text-sm font-medium text-yellow-800 mb-1">Task Description:</label>
                                                <textarea x-model="action.task" 
                                                          placeholder="What specific task needs to be completed?"
                                                          class="w-full p-2 border border-yellow-300 rounded text-sm resize-none bg-white"
                                                          rows="2"></textarea>
                                            </div>
                                            
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-sm font-medium text-yellow-800 mb-1">Owner:</label>
                                                    <input x-model="action.owner" 
                                                           placeholder="Who is responsible?"
                                                           class="w-full p-2 border border-yellow-300 rounded text-sm bg-white">
                                                </div>
                                                
                                                <div>
                                                    <label class="block text-sm font-medium text-yellow-800 mb-1">Deadline:</label>
                                                    <input x-model="action.deadline" 
                                                           type="date"
                                                           class="w-full p-2 border border-yellow-300 rounded text-sm bg-white">
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <label class="block text-sm font-medium text-yellow-800 mb-1">Success Criteria:</label>
                                                <textarea x-model="action.successCriteria" 
                                                          placeholder="How will we know this is complete?"
                                                          class="w-full p-2 border border-yellow-300 rounded text-sm resize-none bg-white"
                                                          rows="2"></textarea>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <label class="block text-sm font-medium text-yellow-800 mb-1">Status:</label>
                                                <select x-model="action.status" class="w-full p-2 border border-yellow-300 rounded text-sm bg-white">
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                    <option value="completed">Completed</option>
                                                    <option value="blocked">Blocked</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            
                            <div x-show="phase4.actionItems.length === 0" class="text-center py-12 text-yellow-600 border-2 border-dashed border-yellow-300 rounded-lg">
                                No action items created yet. Use the control panel to add next steps.
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Session Setup Modal -->
    <div x-show="showSessionModal" 
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         @click.away="showSessionModal = false">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <h2 class="text-xl font-bold mb-4">Session Settings</h2>
            
            <form @submit.prevent="saveSessionSettings">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Team Name</label>
                        <input type="text" x-model="session.teamName" 
                               class="w-full p-2 border border-gray-300 rounded-md text-sm"
                               placeholder="Enter team name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Facilitator</label>
                        <input type="text" x-model="session.facilitator" 
                               class="w-full p-2 border border-gray-300 rounded-md text-sm"
                               placeholder="Enter facilitator name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Timer Duration (seconds)</label>
                        <input type="number" x-model="timer.duration" min="5" max="60"
                               class="w-full p-2 border border-gray-300 rounded-md text-sm">
                    </div>
                </div>
                
                <div class="flex space-x-2 mt-6">
                    <button type="submit" 
                            class="flex-1 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700">
                        Save
                    </button>
                    <button type="button" @click="showSessionModal = false" 
                            class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                        Cancel
                    </button>
                </div>
            </form>
            
            <!-- Local Storage Management Section -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-3">Data Management</h3>
                <p class="text-sm text-gray-600 mb-4">Manage your local session data:</p>
                
                <div class="space-y-2">
                    <!-- Reset Current Session -->
                    <button @click="resetCurrentSession()" 
                            class="w-full px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-colors">
                        🔄 Reset Current Session
                    </button>
                    
                    <!-- Clear All Local Storage -->
                    <button @click="clearLocalStorage()" 
                            class="w-full px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors">
                        🗑️ Clear All Local Storage
                    </button>
                </div>
                
                <div class="text-xs text-gray-500 mt-3">
                    <p><strong>Reset Session:</strong> Starts fresh without affecting other saved sessions</p>
                    <p><strong>Clear Storage:</strong> Deletes all saved sessions and data permanently</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div x-show="showExportModal" 
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         @click.away="showExportModal = false">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <h2 class="text-xl font-bold mb-4">Export Session</h2>
            <p class="text-gray-600 text-sm mb-6">Choose the format for your session export:</p>
            
            <div class="space-y-3">
                <!-- JSON Export -->
                <button @click="exportJSON(); showExportModal = false" 
                        class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 text-left transition-colors">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-blue-600 font-bold text-sm">{ }</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-900">JSON Data</h3>
                            <p class="text-gray-500 text-xs">Complete session data for backup and analysis</p>
                        </div>
                    </div>
                </button>
                
                <!-- Markdown Report Export -->
                <button @click="exportMarkdown(); showExportModal = false" 
                        class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 text-left transition-colors">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-green-600 font-bold text-sm">MD</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-900">Markdown Report</h3>
                            <p class="text-gray-500 text-xs">Formatted report for sharing and documentation</p>
                        </div>
                    </div>
                </button>
                
                <!-- Email Summary (Future) -->
                <button disabled 
                        class="w-full p-4 border-2 border-gray-200 rounded-lg bg-gray-50 text-left opacity-50 cursor-not-allowed">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-gray-400 font-bold text-sm">📧</span>
                        </div>
                        <div>
                            <h3 class="font-medium text-gray-500">Email Summary</h3>
                            <p class="text-gray-400 text-xs">Coming soon - Send summary via email</p>
                        </div>
                    </div>
                </button>
            </div>
            
            <div class="mt-6">
                <button @click="showExportModal = false" 
                        class="w-full px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="js/phase2.js"></script>
    <script src="js/core.js"></script>
</body>
</html>